<template>
    <div class="page" data-name="login">
        <div class="login-page">
            <div class="form">
                <div class="loginHeader">
                    <span>Login</span>
                </div>
                <form class="login-form noSelect" onsubmit="return false;">
                    <input class="username login_uname" type="text" placeholder="Email" />
                    <input class="password login_password" type="password" placeholder="Adgangskode" />
                    <button @click="login">LOGIN</button>
                </form>
            </div>
        </div>
    </div>
</template>

<script>
        return { 
    
            /**
             * Det datasæt som framework bruger internt i dette view, de kan ikke tilgås udefra.
             */
            data: function () {
                return {
                };
            },
    
            // Framework7 Component Methods
            methods: {
                login() {
                    let email = $$('.login_uname').val();
                    let password = $$('.login_password').val();
                    
                    app.request.post(`${app.data['serverIP']}endpoints/web/login.php`, {
                        email: email,
                        password: password
                    }, function (response) {
                        if (response.result == 0) {
                            app.methods.statusMsg(response.message, "error", ".loginHeader");
                            return;
                        } else {
                            loginData = {
                                'Email' : response.email,
                                'FirstName' : response.firstName,
                                'LastName' : response.lastName,
                                'UserID' : response.userID,
                                'Token' : response.token,
                                'Admin' : response.isAdmin
                            }
                            app.methods.setSessionItems(loginData);
                            app.methods.statusMsg(response.message, "success", ".loginHeader");
                            setTimeout(function () { 
                                app.data['loggedIn'] = 1;
                                localStorage.setItem('LoggedIn', true);
                                app.views.main.router.navigate("/currentDay/", { reloadCurrent: true, }) 
                                app.methods.popNavbar();
                            }, 1000);
                        }
                    }, function (e, e2) { console.error(e); console.error(e2) }, "json");
                },
            },
            on: {
                //pageMounted trigger når siden bliver insat i DOMen
                pageMounted: function (page) {
                },
            },
        }
    </script>

    <style>
        .page:not(#navbar) {
            background: #35454c;
        }
    </style>