<template>
    <div class="page" data-name="usergrouplist">
        <div class="bottombox box">

            <div style="margin-left:35px;margin-top:35px;width: 25%">
                <span style="position:absolute;margin-left:5px;margin-top:7px;"><i
                        class="fas fa-search icon-format"></i></span>
                <input id="searchPerNameGrp" style="padding-left: 25px !important;" class="inputfield" type="text"
                    placeholder="Søg per instruktør..">
            </div>

            <div class="box" style="margin: 35px;">
                <div class="boxtitle">Alle lokaler/områder</div>
                <div class="bottombox testbox" style="overflow-y:auto;overflow-x:hidden;max-height:250px;">
                    <table id="userGroupListTable">
                        <thead>
                            <tr>
                                <th style="text-align: center;width:25%;">Navn</th>
                                <th style="text-align: center;width:20%;">Instruktør</th>
                            </tr>
                        </thead>
                        <tbody class="userListBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
    inspectUser = (userID) => {
        app.views.main.router.navigate(`/inspectuser/${userID}/`, { reloadCurrent: true, });
    }

    return {

        /**
         * Det datasæt som framework bruger internt i dette view, de kan ikke tilgås udefra.
         */
        data: function () {
            return {
            };
        },

        // Framework7 Component Methods
        methods: {
            fillTable: function () {
                app.request.getJSON(`${app.data['serverIP']}endpoints/web/getAreas.php?userID=${app.data['userID']}`, {}, function (response) {
                    if (response.result == 1) {
                        let innerHTML = "";
                        Object.keys(response.records).forEach((key, index) => {
                            let value = response.records[key];
                            innerHTML +=
                                `
                            <tr class="trs">
                                <td class="tds" style="text-align:center;">${value.Area}</td>
                                <td class="tds" style="text-align:center;">${value.Instructor}</td>
                                <td style="text-align:center;display:none;">
                                    <input type="checkbox" value="${value.ID}" style="height:20px;width:20px;vertical-align: middle;">
                                </td>
                            </tr>
                                `;
                        });
                        $$('.userListBody').html(innerHTML);
                    } else {
                        $$('.userListBody').html(" ");
                    }
                });
            },

        },
        on: {
            //pageMounted trigger når siden bliver insat i DOMen
            pageMounted: function (page) {
                this.fillTable();
                app.methods.searchFunction('searchPerNameGrp', 'userGroupListTable', 1);

                setTimeout(function () {
                    let topOffset = $$('.testbox')[0].offsetTop;
                    let pageHeight = window.innerHeight;
                    let rest = pageHeight - topOffset - 214;
                    $$('.testbox').css('max-height', `${rest}px`);
                }, 400);

                $$('.userListBody').on('click', (e) => {
                    let inspectedUserGroup = $$(e.target.parentElement).find('input[type="checkbox"]').val();
                    app.views.main.router.navigate(`/userlist/${inspectedUserGroup}/`, { reloadCurrent: true, });
                });
            },
        },
    }


</script>